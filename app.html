<!DOCTYPE html>
<html lang="fr">
<head>
<script>
    if (localStorage.getItem('ox_authenticated') !== 'true') {
        window.location.href = 'index.html';
    }
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OptimizeX PRO</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo"><i data-lucide="car"></i> OPTIMIZEX</div>
            <nav>
                <button class="nav-item active" onclick="switchTab('analyse', this)"><i data-lucide="layout-dashboard"></i> ANALYSE</button>
                <button class="nav-item" onclick="switchTab('expertise', this)"><i data-lucide="check-square"></i> INSPECTION</button>
                <button class="nav-item" onclick="switchTab('nego', this)"><i data-lucide="trending-down"></i> N√âGOCIATION</button>
                <button class="nav-item" onclick="switchTab('annonce', this)"><i data-lucide="megaphone"></i> ANNONCE</button>
                <button class="nav-item btn-db" onclick="switchTab('dashboard', this)" style="margin-top:20px;"><i data-lucide="database"></i> HISTORIQUE</button>
                <button onclick="localStorage.removeItem('ox_authenticated'); window.location.href='index.html';">D√©connexion</button>
            </nav>
        </aside>

        <main class="main-content">
            <section id="analyse" class="view">
                <div class="hero-card">
                    <h1>Dossier <span>Analyse Globale</span></h1>
                    <button class="btn-primary" onclick="lookupVehicle()">V√âHICULE TEST</button>
                </div>
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i data-lucide="car"></i> Identification</h3>
                        <input type="text" id="plate" placeholder="AA-123-AA" class="plate-style">
                        <input type="text" id="model-name" placeholder="Mod√®le">
                        <input type="text" id="motor" placeholder="Motorisation">
                        <input type="number" id="km" placeholder="Kilom√©trage" oninput="runCalculations()">
                        <textarea id="v-notes" placeholder="Notes psychologie vendeur..." style="height: 80px;"></textarea>
                    </div>
                    <div class="card">
                        <h3><i data-lucide="calculator"></i> Finance & Taxes</h3>
                        <label>Valeur March√© (‚Ç¨)</label>
                        <input type="number" id="market-val" oninput="runCalculations()">
                        <label>Prix D'achat (‚Ç¨)</label>
                        <input type="number" id="target-price" oninput="runCalculations()">
                        <label>Frais Administratifs (CG, etc)</label>
                        <input type="number" id="fees-admin" value="0" oninput="runCalculations()">
                        <div class="roi-badge">ROI : <span id="roi-val">0</span>%</div>
                    </div>
                    <div class="card">
                        <h3><i data-lucide="user"></i> Contact</h3>
                        <input type="text" id="v-name" placeholder="Nom du vendeur">
                        <input type="text" id="v-phone" placeholder="T√©l√©phone">
                        <select id="buy-status">
                            <option value="En attente">‚è≥ En attente</option>
                            <option value="ACHET√â">‚úÖ ACHET√â</option>
                            <option value="REFUS√â">‚ùå REFUS√â</option>
                        </select>
                        <button class="btn-orange" onclick="saveCurrentDeal()">üíæ SAUVEGARDER</button>
                    </div>
                    <div class="card dark-card">
                        <h3><i data-lucide="info"></i> Synth√®se</h3>
                        <div class="flash-item"><span>Marge Net</span><strong id="flash-marge">0 ‚Ç¨</strong></div>
                        <div class="flash-item"><span>Frais R√©parations</span><strong id="flash-repairs">0 ‚Ç¨</strong></div>
                        <div class="flash-item"><span>Score Confiance</span><strong id="flash-score">100/100</strong></div>
                    </div>
                </div>
            </section>

            <section id="expertise" class="view" style="display:none;">
                <div class="hero-card"><h1>Inspection <span>27 Points</span></h1></div>
                <div id="checklist-render" class="checklist-grid"></div>
                <div class="card" style="margin-top:20px;">
                    <h3>Calcul des frais</h3>
                    <input type="number" id="repairs" placeholder="Total frais estim√©s (‚Ç¨)" oninput="runCalculations()">
                    <textarea id="body-defects" placeholder="D√©tails des points KO..." style="height:100px;"></textarea>
                </div>
            </section>

            <section id="nego" class="view" style="display:none;">
                <div class="hero-card"><h1>Strat√©gie <span>Ackermann</span></h1></div>
                <div id="ackermann-timeline" class="dashboard-grid"></div>
            </section>

            <section id="dashboard" class="view" style="display:none;">
                <div class="hero-card"><h1>Historique</h1></div>
                <div id="history-list" class="dashboard-grid"></div>
            </section>

            <section id="annonce" class="view" style="display:none;">
                <div class="card">
                    <textarea id="ad-output" rows="15"></textarea>
                    <button class="btn-orange" onclick="copyAd()">COPIER</button>
                </div>
            </section>
        </main>

        <footer class="ia-status-bar">
            <div class="stat-group">
                <small>B√âN√âFICE NET</small>
                <div class="profit-value">+ <span id="marge-val">0</span> ‚Ç¨</div>
            </div>
            <div class="ia-central-brain">
                <div id="ia-pulse" class="brain-pulse"></div>
                <div class="ia-text-wrap">
                    <div id="ia-verdict">ANALYSE...</div>
                    <div class="confidence-bar-bg"><div id="confidence-level" class="confidence-bar-fill"></div></div>
                </div>
            </div>
            <div class="stat-group">
                <small>CONSEIL ACHAT MAX</small>
                <div class="advice-value"><span id="ia-advice">0</span> ‚Ç¨</div>
            </div>
        </footer>
    </div>

    <div id="recap-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="recap-model">D√©tails</h2>
                <button class="close-btn" onclick="closeRecap()">&times;</button>
            </div>
            <div class="recap-grid">
                <div class="recap-item"><strong>Vendeur</strong><span id="recap-vendeur"></span></div>
                <div class="recap-item"><strong>Contact</strong><span id="recap-phone"></span></div>
                <div class="recap-item"><strong>Marge</strong><span id="recap-marge"></span></div>
                <div class="recap-item"><strong>ROI</strong><span id="recap-roi-display"></span></div>
            </div>
            <div class="recap-objection">
                <strong>üí° RIPOSTE N√âGO</strong>
                <p id="recap-riposte"></p>
            </div>
            <div style="margin-top:20px; display:flex; gap:10px;">
                <button class="btn-delete" id="delete-btn">SUPPRIMER</button>
                <button class="btn-orange" onclick="closeRecap()">FERMER</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>